<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="description" content=Aloha!&#32;Welcome&#32;to&#32;cheon&#39;s&#32;blog.>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon" sizes= "76x76" href=https://www.cheon.site/blog/img/apple-touch-icon.png>
    <link rel="icon" href=https://www.cheon.site/blog/img/pen.svg>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/global.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/nav.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/header.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/index.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/list.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/single.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/footer.css>
    
    <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Noto+Sans+SC|Old+Standard+TT&display=swap" rel="stylesheet">
    
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <title>cheon&#39;s blog</title>

</head>
<body><section id="header">
    <ul id="menus">
    
    <li class="menu"><a href="https://www.cheon.site"><span>Home</span></a></li>
    
    <li class="menu"><a href="https://www.cheon.site/blog/categories"><span>Categories</span></a></li>
    
    <li class="menu"><a href="https://www.cheon.site/blog/tags"><span>Tags</span></a></li>
    
    <li class="menu"><a href="https://github.com/number317"><span>Projects</span></a></li>
    
    </ul>
    <h1 id="title"><a href="https://www.cheon.site/blog/">cheon&#39;s blog</a></h1>
</section>
<ul class="nav">






<li>
    »
    <a href="https://www.cheon.site/blog/">
    
    cheon&#39;s blog
    
    </a>
</li>


<li>
    »
    <a href="https://www.cheon.site/blog/shell/">
    
    shell
    
    
    </a>
</li>


<li class="active">
    »
    <a href="https://www.cheon.site/blog/shell/dockerfile_tips/">
    
    Dockerfile Tips
    
    </a>
</li>

</ul>

<div>
<section id="main">
  <h1>Dockerfile Tips</h1>
  <time>Last updated Wed Sep 18, 2019</time>
  <div>
      <article id="content">
          

<h1 id="dockerfile-编写建议">Dockerfile 编写建议</h1>

<p>日常编写<code>Dockerfile</code>的过程中总结的一些经验:</p>

<ul>
<li><p>基础镜像尽量选择<code>alpine</code>版本，减小镜像体积，如果需要glibc，在<code>Dockerfile</code>中添加以下指令</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">RUN apk --no-cache add ca-certificates wget &amp;&amp; \
  wget -q -O /etc/apk/keys/sgerrand.rsa.pub https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub &amp;&amp; \
  wget https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.29-r0/glibc-2.29-r0.apk &amp;&amp; \
  apk --no-cache add glibc-2.29-r0.apk</pre></div></li>
</ul>

<p>关于在<code>alpine</code>镜像中安装<code>glibc</code>，详情可以参考<a href="https://github.com/sgerrand/alpine-pkg-glibc">github</a>介绍</p>

<ul>
<li><p>在<code>Dockerfile</code>里需要安装软件的尽量使用国内的源，加快ci构建，常见的操作如下：</p>

<ul>
<li><p>alpine:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">RUN sed -i &#39;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#39; /etc/apk/repositories</pre></div></li>

<li><p>debian:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">curl -L &#34;https://mirrors.ustc.edu.cn/repogen/conf/debian-https-4-buster&#34; -o /etc/apt/sources.list</pre></div></li>

<li><p>centos:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">RUN curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</pre></div></li>

<li><p>node:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">RUN npm install --registry=https://registry.npm.taobao.org \
&amp;&amp; npm config set phantomjs_cdnurl https://npm.taobao.org/dist/phantomjs \
&amp;&amp; npm config set chromedriver_cdnurl http://cdn.npm.taobao.org/dist/chromedriver \
&amp;&amp; npm config set sass_binary_site http://npm.taobao.org/mirrors/node-sass</pre></div></li>
</ul></li>

<li><p>构建镜像时如果需要代理，可以配置以下参数：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">docker build -t imagename . --build-arg HTTP_PROXY=http://ip:port --build-arg HTTPS_PROXY=http://ip:port</pre></div></li>

<li><p><code>apt-get</code> 命令可以通过以下参数临时设置代理:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">RUN apt update -o Acquire::http::proxy=&#34;http://ip:port&#34; -o Acquire::https::proxy=&#34;http://ip:port&#34; &amp;&amp; \
  apt install --yes curl -o Acquire::http::proxy=&#34;http://ip:port&#34; -o Acquire::https::proxy=&#34;http://ip:port&#34;</pre></div></li>

<li><p>镜像设置北京时间，可以安装<code>tzdata</code>软件包，再设置<code>/etc/localtime</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">RUN apk add tzdata &amp;&amp; ln -sfv /usr/share/zoneinfo/Asia/Shanghai /etc/localtime </pre></div></li>

<li><p>如果容器中文显示乱码，可以在<code>Dockerfile</code>中配置<code>LANG</code>环境变量:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">ENV LANG C.UTF-8</pre></div></li>
</ul>

      </article>
  </div>
</section>

<aside>
    <h4 id="signature">
        Thu Jun 13, 2019
        
            cheon
        
    </h4>
    
    
    <ul class="tags">
      
        <li> <a href="https://www.cheon.site/blog/tags/docker">docker</a> </li>
      
    </ul>
    
    <ul class="related">
        
        <li><a class="previous" href="https://www.cheon.site/blog/shell/es_clean_indices/"> Es Clean Indices</a></li>
        
        
    </ul>
</aside>

        </div><section id="footer">

<div id="author">
    <h2>About Author</h2>
    <hr>
    <img src=https://www.cheon.site/images/author.jpg></img>
    <p>Life is dance we all have to do.</p>
</div>
<ul id="link">
    <li><a href=https://github.com/number317/aloha.git target="_blank"><i class="fa fa-github" alt="github"></i></a></li>
    <li><a href="mailto:cheon0112358d@gmail.com?subject=blog%27s%20feedback" target="_blank"><i class="fa fa-envelope" alt="email"></i></a></li>
    <li id="wechat"><i class="fa fa-wechat"></i></li>
    <img class="qrcode" src=https://www.cheon.site/images/wechat.jpg>
</ul>
</section>
</body>
</html>

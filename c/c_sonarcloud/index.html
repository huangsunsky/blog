<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="description" content=Aloha!&#32;Welcome&#32;to&#32;cheon&#39;s&#32;blog.>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon" sizes= "76x76" href=https://www.cheon.site/blog/img/apple-touch-icon.png>
    <link rel="icon" href=https://www.cheon.site/blog/img/pen.svg>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/global.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/nav.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/header.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/index.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/list.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/single.css>
    <link rel="stylesheet" href=https://www.cheon.site/blog/css/footer.css>
    
    <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Noto+Sans+SC|Old+Standard+TT&display=swap" rel="stylesheet">
    
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <title>cheon&#39;s blog</title>

</head>
<body><section id="header">
    <ul id="menus">
    
    <li class="menu"><a href="https://www.cheon.site"><span>Home</span></a></li>
    
    <li class="menu"><a href="https://www.cheon.site/blog/categories"><span>Categories</span></a></li>
    
    <li class="menu"><a href="https://www.cheon.site/blog/tags"><span>Tags</span></a></li>
    
    <li class="menu"><a href="https://github.com/number317"><span>Projects</span></a></li>
    
    </ul>
    <h1 id="title"><a href="https://www.cheon.site/blog/">cheon&#39;s blog</a></h1>
</section>
<ul class="nav">






<li>
    »
    <a href="https://www.cheon.site/blog/">
    
    cheon&#39;s blog
    
    </a>
</li>


<li>
    »
    <a href="https://www.cheon.site/blog/c/">
    
    c
    
    
    </a>
</li>


<li class="active">
    »
    <a href="https://www.cheon.site/blog/c/c_sonarcloud/">
    
    C Sonarcloud
    
    </a>
</li>

</ul>

<div>
<section id="main">
  <h1>C Sonarcloud</h1>
  <time>Last updated Fri Jun 14, 2019</time>
  <div>
      <article id="content">
          

<h1 id="c-配置-sonarcloud">C 配置 Sonarcloud</h1>

<p>SonarQube 用于代码质量分析，可以检测出代码的 bug，代码异味，测试覆盖率等，有助于提高代码质量。SonarCloud 是 SonarQube 的在线使用版本，可以集成 github，travisCI。具体操作可以看<a href="https://sonarcloud.io/documentation">官方文档</a>。</p>

<p>之前写了一个终端管理 ssh 登录的小工具，想着检测一下代码质量，就想到用这个工具来检测一下。由于不需要每次提交都进行质量检测，所以没有集成到 CI 里面，而是在服务器上利用 SonarQube Scanner 手动执行。从<a href="https://sonarcloud.io/dashboard?id=number317_ssh-tool">检测结果</a>来看，代码中确实有一些 bug 和代码异味。</p>

<h2 id="安装-build-wrapper">安装 build wrapper</h2>

<p>在<a href="https://sonarcloud.io/static/cpp/build-wrapper-linux-x86.zip">下载页</a>下载 linux 版的 build wrapper，解压出来应该有两个可执行文件。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">build-wrapper-linux-x86/
├── build-wrapper-linux-x86-32
├── build-wrapper-linux-x86-64
├── libinterceptor-i686.so
└── libinterceptor-x86_64.so</code></pre></div>
<p>可以将该目录加进<code>PATH</code>变量，方便调用。</p>

<h2 id="安装-sonarqube-scanner">安装 SonarQube Scanner</h2>

<p>在<a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner">下载页</a>找到对应的平台，下载压缩包。解压后得到如下目录：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sonar-scanner-3.3.0.1492-linux
├── bin
├── conf
├── jre
└── lib</code></pre></div>
<p>可以将上面的<code>bin</code>目录添加到<code>PATH</code>环境变量中。</p>

<h2 id="构建并分析代码">构建并分析代码</h2>

<p>在项目的根目录下执行命令：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">build-wrapper-linux-x86-64 --out-dir bw-output make
<span style="font-weight:bold;font-style:italic">export</span> <span style="color:#666;font-weight:bold;font-style:italic">JAVA_TOOL_OPTIONS</span>=<span style="color:#666;font-style:italic">&#34;-Dhttp.proxyHost=127.0.0.1 -Dhttp.proxyPort=443 -Dhttps.proxyHost=127.0.0.1 -Dhttps.proxyPort=443&#34;</span>
sonar-scanner <span style="color:#666;font-style:italic">\
</span><span style="color:#666;font-style:italic"></span>  -Dsonar.projectKey=number317_ssh-tool <span style="color:#666;font-style:italic">\
</span><span style="color:#666;font-style:italic"></span>  -Dsonar.organization=number317-github <span style="color:#666;font-style:italic">\
</span><span style="color:#666;font-style:italic"></span>  -Dsonar.sources=. <span style="color:#666;font-style:italic">\
</span><span style="color:#666;font-style:italic"></span>  -Dsonar.cfamily.gcov.reportsPath=. <span style="color:#666;font-style:italic">\
</span><span style="color:#666;font-style:italic"></span>  -Dsonar.cfamily.build-wrapper-output=bw-output <span style="color:#666;font-style:italic">\
</span><span style="color:#666;font-style:italic"></span>  -Dsonar.host.url=https://sonarcloud.io <span style="color:#666;font-style:italic">\
</span><span style="color:#666;font-style:italic"></span>  -Dsonar.login=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code></pre></div>
<ul>
<li><code>JAVA_TOOL_OPTIONS</code>里面配置了代理服务器。</li>
<li><code>-Dsonar.cfamily.gcov.reportsPath</code>配置了 gcov 测试结果的路径，用于覆盖率测试。覆盖率测试不达到 80%，代码质量检测无法通过。</li>
<li><code>-Dsonar.login</code>需要配置 Token，可以在 account → security 生成</li>
</ul>

      </article>
  </div>
</section>

<aside>
    <h4 id="signature">
        Mon May 6, 2019
        
            cheon
        
    </h4>
    
    
    <ul class="tags">
      
        <li> <a href="https://www.cheon.site/blog/tags/c">c</a> </li>
      
        <li> <a href="https://www.cheon.site/blog/tags/sonarqub">sonarqub</a> </li>
      
    </ul>
    
    <ul class="related">
        
        
        <li><a class="next" href="https://www.cheon.site/blog/c/standard_io/"> Standard I/O</a></li>
        
    </ul>
</aside>

        </div><section id="footer">

<div id="author">
    <h2>About Author</h2>
    <hr>
    <img src=https://www.cheon.site/images/author.jpg></img>
    <p>Life is dance we all have to do.</p>
</div>
<ul id="link">
    <li><a href=https://github.com/number317/aloha.git target="_blank"><i class="fa fa-github" alt="github"></i></a></li>
    <li><a href="mailto:cheon0112358d@gmail.com?subject=blog%27s%20feedback" target="_blank"><i class="fa fa-envelope" alt="email"></i></a></li>
    <li id="wechat"><i class="fa fa-wechat"></i></li>
    <img class="qrcode" src=https://www.cheon.site/images/wechat.jpg>
</ul>
</section>
</body>
</html>
